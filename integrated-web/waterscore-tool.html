<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nitrogen emissions calculator</title>
    <link rel="stylesheet" href="static/styles.css">
    <script src="scriptnew.js" defer></script> 
</head>
  <body>
    <!-- INPUT -->
    <div class="header"><h2>Water Score Calculator</h2></div>
    <div class="questions">
        <div class="calculation-section">
        <div class="band">
          <h2>Feed Information</h2> </div>
        <div class="interior">
        <label for="lowproteinfeed">Do you use low protein feed?</label>
        <label>
            <input type="radio" name="lowproteinfeed" value="yes"> Yes
          </label>
          <label>
            <input type="radio" name="lowproteinfeed" value="no"> No
          </label>
        <button class="info-button" onclick="toggleInfo('info-feed')">?</button>
        <div id="info-feed" class="info-text hidden">
          Do you use adjusted feed with low protein content?
          </div> <br> <br>
          <label for="grindfeed">Do you grind the feed?</label>
          <label>
            <input type="radio" name="grindfeed" value="yes"> Yes
          </label>
          <label>
            <input type="radio" name="grindfeed" value="no"> No
          </label>
          <button class="info-button" onclick="toggleInfo('info-grindfeed')">?</button>
          <div id="info-grindfeed" class="info-text hidden">
            Grinding the feed maximizes its efficiency and reduces nitrogen loss.
            </div> <br> <br>
        <label for="additives">Do you use feed additives (such as enzymes, probiotics and organic acids)?
          </label>
          <label>
            <input type="radio" name="additives" value="yes"> Yes
          </label>
          <label>
            <input type="radio" name="additives" value="no"> No
          </label>
          <button class="info-button" onclick="toggleInfo('info-additives')">?</button>
          <div id="info-additives" class="info-text hidden">
            Using feed additives like enzymes, probiotics, and organic acids improves nutrient absorption in livestock, which reduces nitrogen excretion and lowers nitrogen pollution in manure.
            </div> <br> <br>

            <div class="band">
                <h2>Production Efficiency</h2> </div>
              <div class="interior">
                <label for="milking">Do you have an increased milking frequency?</label>
                <label>
                  <input type="radio" name="milking" value="yes"> Yes
                </label>
                <label>
                  <input type="radio" name="milking" value="no"> No
                </label>
                <button class="info-button" onclick="toggleInfo('info-milking')">?</button>
                <div id="info-milking" class="info-text hidden">
                    Increased milking frequency boosts milk production without a proportional rise in nitrogen excretion, leading to lower nitrogen waste per unit of output. 
                  </div> <br> <br>
              <label for="photop">Do you expose your animals to light for extended periods (extended photoperiod)?
                </label>
                <label>
                  <input type="radio" name="photop" value="yes"> Yes
                </label>
                <label>
                  <input type="radio" name="photop" value="no"> No
                </label>
                <button class="info-button" onclick="toggleInfo('info-photo')">?</button>
                <div id="info-photo" class="info-text hidden">
                  Using feed additives like enzymes, probiotics, and organic acids improves nutrient absorption in livestock, which reduces nitrogen excretion and lowers nitrogen pollution in manure.
                  </div> <br> <br>

                  <div class="band">
                    <h2>Manure Storage and Application</h2> </div>
                  <div class="interior">
                  <label for="manadd">Do you add manure additive such as digestive additives, acidifying additives, and adsorbents?</label>
                 <label>
                    <input type="radio" name="manadd" value="yes"> Yes
                  </label>
                  <label>
                    <input type="radio" name="manadd" value="no"> No
                  </label>
                  <button class="info-button" onclick="toggleInfo('info-manadd')">?</button>
                  <div id="info-manadd" class="info-text hidden">
                    Growth hormone injections increase feed efficiency and animal productivity, which reduces the amount of nitrogen excreted per unit of production. 
                    </div> <br> <br>
                    <label for="season">Do you apply manure to a growing crop or just before the establishment of a crop (in spring instead of autumn)?</label>
                    <label>
                      <input type="radio" name="season" value="yes"> Yes
                    </label>
                    <label>
                      <input type="radio" name="season" value="no"> No
                    </label>
                    <button class="info-button" onclick="toggleInfo('info-season')">?</button>
                    <div id="info-season" class="info-text hidden">
                        Increased milking frequency boosts milk production without a proportional rise in nitrogen excretion, leading to lower nitrogen waste per unit of output. 
                      </div> <br> <br>
                  <label for="excessn">Do you avoid applying excess nitrogen (beyond crop needs)?
                    </label>
                    <label>
                      <input type="radio" name="excessn" value="yes"> Yes
                    </label>
                    <label>
                      <input type="radio" name="excessn" value="no"> No
                    </label>
                    <button class="info-button" onclick="toggleInfo('info-excessn')">?</button>
                    <div id="info-excessn" class="info-text hidden">
                      Using feed additives like enzymes, probiotics, and organic acids improves nutrient absorption in livestock, which reduces nitrogen excretion and lowers nitrogen pollution in manure.
                      </div> <br> <br>
                      <div class="band">
                        <h2>Grazing</h2> </div>
                      <div class="interior">
                      <label for="grtime">Do you minimize grazing time?</label>
                      <label>
                        <input type="radio" name="grtime" value="yes"> Yes
                      </label>
                      <label>
                        <input type="radio" name="grtime" value="no"> No
                      </label>
                      <button class="info-button" onclick="toggleInfo('info-grtime')">?</button>
                      <div id="info-grtime" class="info-text hidden">
                        Growth hormone injections increase feed efficiency and animal productivity, which reduces the amount of nitrogen excreted per unit of production. 
                        </div> <br> <br>
                        <label for="spread">Do you spread watering and supplemental feeding areas evenly?</label>
                        <label>
                          <input type="radio" name="spread" value="yes"> Yes
                        </label>
                        <label>
                          <input type="radio" name="spread" value="no"> No
                        </label>
                        <button class="info-button" onclick="toggleInfo('info-spread')">?</button>
                        <div id="info-spread" class="info-text hidden">
                            Increased milking frequency boosts milk production without a proportional rise in nitrogen excretion, leading to lower nitrogen waste per unit of output. 
                          </div> <br> <br>
                      <label for="grseason">Do you avoid grazing in the late autumn or winter?</label>
                        <label>
                          <input type="radio" name="grseason" value="yes"> Yes
                        </label>
                        <label>
                          <input type="radio" name="grseason" value="no"> No
                        </label>
                        <button class="info-button" onclick="toggleInfo('info-grseason')">?</button>
                        <div id="info-grseason" class="info-text hidden">
                          Using feed additives like enzymes, probiotics, and organic acids improves nutrient absorption in livestock, which reduces nitrogen excretion and lowers nitrogen pollution in manure.
                          </div> <br> <br>
                          <label for="atgrowth">Do you remove the autumn growth through silage harvest?</label>
                          <label>
                          <input type="radio" name="atgrowth" value="yes"> Yes
                        </label>
                        <label>
                          <input type="radio" name="atgrowth" value="no"> No
                        </label>
                          <button class="info-button" onclick="toggleInfo('info-atgrowth')">?</button>
                          <div id="info-atgrowth" class="info-text hidden">
                            Using feed additives like enzymes, probiotics, and organic acids improves nutrient absorption in livestock, which reduces nitrogen excretion and lowers nitrogen pollution in manure.
                            </div> <br> <br>
                            <label for="nitrif">Do you apply a nitrification inhibitor?</label>
                            <label>
                              <input type="radio" name="nitrif" value="yes"> Yes
                            </label>
                            <label>
                              <input type="radio" name="nitrif" value="no"> No
                            </label>
                            <button class="info-button" onclick="toggleInfo('info-nitrif')"> ? </button>
                            <div id="info-nitrif" class="info-text hidden">
                              Using feed additives like enzymes, probiotics, and organic acids improves nutrient absorption in livestock, which reduces nitrogen excretion and lowers nitrogen pollution in manure.
                              </div> <br> <br>
                              <div class="band">
                              <h2>Livestock Intensity</h2> </div>
                              <div class="interior">
                              <label for="lstock">Do you reduce livestock desity?</label>
                              <label>
                                <input type="radio" name="lstock" value="yes"> Yes
                              </label>
                              <label>
                                <input type="radio" name="lstock" value="no"> No
                              </label>
                              <button class="info-button" onclick="toggleInfo('info-lstock')">?</button>
                              <div id="info-lstock" class="info-text hidden">
                                Growth hormone injections increase feed efficiency and animal productivity, which reduces the amount of nitrogen excreted per unit of production. 
                                </div> <br> <br>
            <button id="calculateBtn" class="calculate-button" onclick="showDiagram()">Calculate Water Score</button>

            <div id="waterScoreDisplay" style="display:none; margin-top: 20px;">
          <div id="scoreBar" style="display: flex; gap: 5px; font-weight: bold;">
            <div class="score-box" id="score-A" style="background: #008000; color: white;">A</div>
            <div class="score-box" id="score-B" style="background: #85C441; color: white;">B</div>
            <div class="score-box" id="score-C" style="background: #FFD700; color: white;">C</div>
            <div class="score-box" id="score-D" style="background: #FFA500; color: white;">D</div>
            <div class="score-box" id="score-E" style="background: #FF0000; color: white;">E</div>
          </div>
</div>
        </div> 
        <script>
        function calculateWaterScore() {
        const inputs = {
          lowProteinFeed: document.querySelector('input[name="lowproteinfeed"]:checked')?.value === 'yes',
          grindFeed: document.querySelector('input[name="grindfeed"]:checked')?.value === 'yes',
          feedAdditives: document.querySelector('input[name="additives"]:checked')?.value === 'yes',
          growthHormones: document.querySelector('input[name="injection"]:checked')?.value === 'yes',
          increasedMilking: document.querySelector('input[name="milking"]:checked')?.value === 'yes',
          extendedPhotoperiod: document.querySelector('input[name="photop"]:checked')?.value === 'yes',
          manureAdditive: document.querySelector('input[name="manadd"]:checked')?.value === 'yes',
          applySpring: document.querySelector('input[name="season"]:checked')?.value === 'yes',
          avoidExcessN: document.querySelector('input[name="excessn"]:checked')?.value === 'yes',
          reduceGrazingTime: document.querySelector('input[name="grtime"]:checked')?.value === 'yes',
          spreadGrazing: document.querySelector('input[name="spread"]:checked')?.value === 'yes',
          avoidWinterGrazing: document.querySelector('input[name="grseason"]:checked')?.value === 'yes',
          harvestAutumnGrowth: document.querySelector('input[name="atgrowth"]:checked')?.value === 'yes',
          nitrificationInhibitor: document.querySelector('input[name="nitrif"]:checked')?.value === 'yes',
          reduceLivestockDensity: document.querySelector('input[name="lstock"]:checked')?.value === 'yes',
        };

        //category weights from the table calculations
        const categoryWeights = {
          feeding: 0.1757594,
          production: 0.1781403,
          manure: 0.2589259,
          grazing: 0.12275609,
          livestock: 0.26441832,
        };

        //raw weights multiplied by their category weight
        const weights = {
          //feeding 
          lowProteinFeed: 0.214 * categoryWeights.feeding,         
          grindFeed: 0.179 * categoryWeights.feeding,               
          feedAdditives: 0.607 * categoryWeights.feeding,           

          //production efficiency
          growthHormones: 0.411 * categoryWeights.production,       
          increasedMilking: 0.271 * categoryWeights.production,     
          extendedPhotoperiod: 0.317 * categoryWeights.production,  

          //manure management
          manureAdditive: 0.284 * categoryWeights.manure,           
          applySpring: 0.260 * categoryWeights.manure,              
          avoidExcessN: 0.456 * categoryWeights.manure,             

          //grazing
          reduceGrazingTime: 0.127 * categoryWeights.grazing,       
          spreadGrazing: 0.404 * categoryWeights.grazing,         
          avoidWinterGrazing: 0.151 * categoryWeights.grazing,      
          harvestAutumnGrowth: 0.168 * categoryWeights.grazing,     
          nitrificationInhibitor: 0.150 * categoryWeights.grazing,  

          //livestock intensity (just one practice, so 1 × category weight)
          reduceLivestockDensity: 1 * categoryWeights.livestock,   
        };

        let totalScore = 0;
        for (const key in inputs) {
          if (inputs[key]) {
            totalScore += weights[key];
          }
        }

        const maxScore = Object.values(weights).reduce((a, b) => a + b, 0);
        const normalizedScore = totalScore / maxScore;

        let grade;
        if (normalizedScore >= 0.8) grade = 'A';
        else if (normalizedScore >= 0.6) grade = 'B';
        else if (normalizedScore >= 0.4) grade = 'C';
        else if (normalizedScore >= 0.2) grade = 'D';
        else grade = 'E';

        return grade;
      }
      document.getElementById('waterScoreContainer').style.display = 'block';
      document.querySelectorAll('.score-box').forEach(box => box.classList.remove('active'));

      const activeBox = document.getElementById(`score-${grade}`);
      if (activeBox) activeBox.classList.add('active');
      document.getElementById('calculateBtn').addEventListener('click', calculateWaterScore);
     </script>
          
  </body>
        </div> 
        <script>
        function calculateWaterScore() {
        const inputs = {
          lowProteinFeed: document.querySelector('input[name="lowproteinfeed"]:checked')?.value === 'yes',
          grindFeed: document.querySelector('input[name="grindfeed"]:checked')?.value === 'yes',
          feedAdditives: document.querySelector('input[name="additives"]:checked')?.value === 'yes',
          growthHormones: document.querySelector('input[name="injection"]:checked')?.value === 'yes',
          increasedMilking: document.querySelector('input[name="milking"]:checked')?.value === 'yes',
          extendedPhotoperiod: document.querySelector('input[name="photop"]:checked')?.value === 'yes',
          manureAdditive: document.querySelector('input[name="manadd"]:checked')?.value === 'yes',
          applySpring: document.querySelector('input[name="season"]:checked')?.value === 'yes',
          avoidExcessN: document.querySelector('input[name="excessn"]:checked')?.value === 'yes',
          reduceGrazingTime: document.querySelector('input[name="grtime"]:checked')?.value === 'yes',
          spreadGrazing: document.querySelector('input[name="spread"]:checked')?.value === 'yes',
          avoidWinterGrazing: document.querySelector('input[name="grseason"]:checked')?.value === 'yes',
          harvestAutumnGrowth: document.querySelector('input[name="atgrowth"]:checked')?.value === 'yes',
          nitrificationInhibitor: document.querySelector('input[name="nitrif"]:checked')?.value === 'yes',
          reduceLivestockDensity: document.querySelector('input[name="lstock"]:checked')?.value === 'yes',
        };

        //category weights from the table calculations
        const categoryWeights = {
          feeding: 0.1757594,
          production: 0.1781403,
          manure: 0.2589259,
          grazing: 0.12275609,
          livestock: 0.26441832,
        };

        //raw weights multiplied by their category weight
        const weights = {
          //feeding 
          lowProteinFeed: 0.214 * categoryWeights.feeding,         
          grindFeed: 0.179 * categoryWeights.feeding,               
          feedAdditives: 0.607 * categoryWeights.feeding,           

          //production efficiency
          growthHormones: 0.411 * categoryWeights.production,       
          increasedMilking: 0.271 * categoryWeights.production,     
          extendedPhotoperiod: 0.317 * categoryWeights.production,  

          //manure management
          manureAdditive: 0.284 * categoryWeights.manure,           
          applySpring: 0.260 * categoryWeights.manure,              
          avoidExcessN: 0.456 * categoryWeights.manure,             

          //grazing
          reduceGrazingTime: 0.127 * categoryWeights.grazing,       
          spreadGrazing: 0.404 * categoryWeights.grazing,         
          avoidWinterGrazing: 0.151 * categoryWeights.grazing,      
          harvestAutumnGrowth: 0.168 * categoryWeights.grazing,     
          nitrificationInhibitor: 0.150 * categoryWeights.grazing,  

          //livestock intensity (just one practice, so 1 × category weight)
          reduceLivestockDensity: 1 * categoryWeights.livestock,   
        };

        let totalScore = 0;
        for (const key in inputs) {
          if (inputs[key]) {
            totalScore += weights[key];
          }
        }

        const maxScore = Object.values(weights).reduce((a, b) => a + b, 0);
        const normalizedScore = totalScore / maxScore;

        let grade;
        if (normalizedScore >= 0.8) grade = 'A';
        else if (normalizedScore >= 0.6) grade = 'B';
        else if (normalizedScore >= 0.4) grade = 'C';
        else if (normalizedScore >= 0.2) grade = 'D';
        else grade = 'E';

      const display = document.getElementById('waterScoreDisplay');
      display.style.display = 'block';

  
      document.querySelectorAll('.score-box').forEach(box => box.classList.remove('active'));
      const activeBox = document.getElementById(`score-${grade}`);
      if (activeBox) activeBox.classList.add('active');
    }
      document.getElementById('calculateBtn').addEventListener('click', calculateWaterScore);


      function toggleInfo(id) {
        const element = document.getElementById(id);
        element.classList.toggle('hidden')
      }
     </script>
          
  </body>